(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{1416:function(e,t,n){"use strict";n.r(t);n(102);var r=n(12),o=(n(52),n(1)),c=n(1404),m=n.n(c),d=(n(39),n(25),n(20),n(26),n(3)),l=(n(11),n(247));function f(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function y(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?f(Object(source),!0).forEach((function(t){Object(d.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):f(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var v=function(e){return new Promise((function(t){return setTimeout(t,e)}))},h=o.a.extend({data:function(){return{paymentRequests:{}}},created:function(){this.refreshPaymentRequests()},methods:y(y({},Object(l.b)(["fetchPaymentRequests","refundPaymentRequest","requestPayment","cancelPaymentRequest"])),{},{refreshPaymentRequests:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.fetchPaymentRequests();case 2:e.paymentRequests=t.sent;case 3:case"end":return t.stop()}}),t)})))()},date:function(e){return new Date(1e3*e)},amountPaid:function(e){return this.paymentRequests[e].utxos.items.reduce((function(e,t){return e+t.satoshis}),0)},info:function(e){var t=this.amountPaid,n=this.paymentRequests,r=y(y({},n[e].docs[0]),{},{summary:n[e].summary,utxos:n[e].utxos});return r.encAddress+" "+r.encSatoshis+"/"+t(e)+" intent:"+r.refId.slice(-4)+" txs:"+r.summary.txAppearances},options:function(e){var t=this.paymentRequests[e].status;return"Pending"===t?["Amend","Cancel"]:"Underpaid"===t?["Amend"]:"Overpaid"===t?["Refund"]:"Paid"===t?["Refund","Amend"]:"Refunded"===t?["Amend"]:"Cancelled"===t?[""]:void 0},execOption:function(option,e){var t=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var r,o,c,m,d,l,f,y,h,O,P,_,x,R,I,w;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(console.log("exec option",option),"Cancel"!==option){n.next=16;break}return r=t.paymentRequests[e].docs[0],t.$store.commit("showSnackbar",{text:"Cancelling ".concat(r.refId),color:"blue"}),(o=r).satoshis=0,o.fiatAmount=0,o.address=r.encAddress,o.fiatSymbol=r.encFiatSymbol,console.log("cancel document :>> ",o),n.next=12,t.requestPayment(o);case 12:return t.$store.commit("showSnackbar",{text:"Cancelled PaymentRequest ".concat(r.refId),color:"success"}),n.next=15,v(1e3);case 15:t.refreshPaymentRequests();case 16:if("Refund"!==option){n.next=27;break}return c=t.paymentRequests[e].docs[0],t.$store.commit("showSnackbar",{text:"Refunding ".concat(c.refId),color:"blue"}),m=c.requesteeUserId,d=c.requesteeUserName,l=c.memo,f=c.refId,y=c.encAddress,n.next=22,t.requestPayment({requesteeUserId:m,requesteeUserName:d,satoshis:0,memo:l+" -> Refund",refId:f,fiatAmount:0,fiatSymbol:"",address:y});case 22:return n.next=24,t.refundPaymentRequest({requestDocument:c});case 24:return n.next=26,v(1e3);case 26:t.refreshPaymentRequests();case 27:"Amend"===option&&(h=t.paymentRequests[e].docs[0].refId,O=t.paymentRequests[e].docs[0],P=O.requesteeUserName,_=O.requesteeUserId,x=O.encFiatAmount,R=t.paymentRequests[e].status,I=t.paymentRequests[e].docs.filter((function(e){return"0"!==e.encFiatAmount}))[0],w={refId:h,requesteeUserId:_,requesteeUserName:P,fiatAmount:x,prevDocument:I,mode:option,status:R},t.$store.commit("setPOSOptions",w),t.$router.push("/charge"));case 28:case"end":return n.stop()}}),n)})))()}})}),O=n(136),P=n(196),_=n.n(P),x=n(326),R=n(324),I=n(1415),component=Object(O.a)(h,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("v-btn",{staticClass:"mt-10",attrs:{fab:"",small:""},on:{click:e.refreshPaymentRequests}},[n("v-icon",[e._v("mdi-refresh ")])],1),e._v(" "),n("v-simple-table",{staticClass:"mt-10",scopedSlots:e._u([{key:"default",fn:function(){return[n("thead",[n("tr",[n("th",{staticClass:"text-left"},[e._v("Date time")]),e._v(" "),n("th",{staticClass:"text-left"},[e._v("Username")]),e._v(" "),n("th",{staticClass:"text-left"},[e._v("Amount")]),e._v(" "),n("th",{staticClass:"text-left"},[e._v("Status")]),e._v(" "),n("th",{staticClass:"text-left"},[e._v("Actions")])])]),e._v(" "),n("tbody",e._l(e.paymentRequests,(function(t,r){return n("tr",{key:r},[n("td",[n("timeago",{staticClass:"subtitle-1",attrs:{datetime:e.date(t.docs[0].timestamp),"auto-update":60}})],1),e._v(" "),n("td",[e._v(e._s(t.docs[0].requesteeUserName))]),e._v(" "),n("td",[e._v("\n            "+e._s("0"===t.docs[0].encFiatAmount?"-":t.docs[0].encFiatAmount)+"\n            "+e._s(t.docs[0].encFiatSymbol)+"\n          ")]),e._v(" "),n("td",[e._v(e._s(t.status))]),e._v(" "),n("td",e._l(e.options(r),(function(option,t){return n("v-btn",{key:t,attrs:{text:"",small:"",dense:"",color:"blue"},on:{click:function(t){return e.execOption(option,r)}}},[e._v("\n              "+e._s(option)+"\n            ")])})),1)])})),0)]},proxy:!0}])})],1)}),[],!1,null,"75ccda36",null),w=component.exports;_()(component,{VBtn:x.a,VIcon:R.a,VSimpleTable:I.a});function j(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function k(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?j(Object(source),!0).forEach((function(t){Object(d.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):j(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var A=function(e){return new Promise((function(t){return setTimeout(t,e)}))},S=o.a.extend({data:function(){return{paymentIntents:{}}},computed:k(k({},Object(l.d)(["paymentIntentsVisible"])),{},{freshPaymentIntents:function(){var e=this.paymentIntents,t=[];for(var n in e)t.push(e[n]);return t.sort((function(a,b){return b.timestamp-a.timestamp})),t}}),created:function(){this.pollPaymentIntents()},mounted:function(){return Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},methods:k(k(k({},Object(l.b)(["queryDocuments"])),Object(l.c)(["dismissPaymentIntent"])),{},{dismissIntent:function(e){console.log("this.paymentIntentsVisible :>> ",this.paymentIntentsVisible),this.dismissPaymentIntent(e),console.log("this.paymentIntentsVisible :>> ",this.paymentIntentsVisible)},requestFromUserId:function(e){var t=this.paymentIntents[e];console.log("intent :>> ",t);var n={refId:t.$id,requesteeUserId:e,requesteeUserName:t.requesteeUserName,fiatAmount:t.encFiatAmount,mode:"Intent"};this.$store.commit("setPOSOptions",n),this.dismissIntent(t.$id),this.$router.push("/charge")},pollPaymentIntents:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("/"===e.$router.currentRoute.path){t.next=2;break}return t.abrupt("return");case 2:return n={limit:10,startAt:1,orderBy:[["timestamp","desc"]],where:[["requesterUserId","==",e.$store.state.name.docId],["timestamp",">",Math.floor(Date.now()/1e3)-120]]},t.next=5,e.queryDocuments({contract:"PaymentRequest",typeLocator:"PaymentIntent",queryOpts:n});case 5:return r=t.sent,e.paymentIntents=r.reverse().reduce((function(map,e){return map[e.data.requesteeUserId]=e.toJSON(),map}),{}),t.next=9,A(1e3);case 9:e.pollPaymentIntents();case 10:case"end":return t.stop()}}),t)})))()}})}),U=n(1352),V=n(1418),C=Object(O.a)(S,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",e._l(e.freshPaymentIntents,(function(t,r){return n("v-banner",{key:r,attrs:{value:e.paymentIntentsVisible[t.$id],sticky:"","single-line":"",outlined:"",transition:"slide-y-transition"},scopedSlots:e._u([{key:"actions",fn:function(){return[n("v-btn",{attrs:{dark:"",color:"green"},on:{click:function(n){return e.requestFromUserId(t.requesteeUserId)}}},[e._v("Request Money")]),e._v(" "),n("v-btn",{attrs:{text:"",color:"red"},on:{click:function(n){return e.dismissIntent(t.$id)}}},[e._v("Dismiss")])]},proxy:!0}],null,!0)},[n("v-avatar",{attrs:{slot:"icon",color:"deep-purple accent-4",size:"40"},slot:"icon"},[n("v-icon",{attrs:{icon:"mdi-account",color:"white"}},[e._v("\n        mdi-account\n      ")])],1),e._v(" "),n("b",[e._v("\n      "+e._s(t.requesteeUserName)+"\n    ")]),e._v("\n    is ready to pay.\n    ")],1)})),1)}),[],!1,null,"2ec307d3",null),$=C.exports;_()(C,{VAvatar:U.a,VBanner:V.a,VBtn:x.a,VIcon:R.a}),o.a.component(m.a.name,m.a);var D=o.a.extend({components:{PaymentRequestHistory:w,PaymentIntents:$},data:function(){return{}},mounted:function(){return Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},methods:{}}),F=n(1353),N=n(1342),E=n(1335),B=n(1337),T=Object(O.a)(D,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("v-banner",{staticStyle:{background:"white"},attrs:{sticky:"",outlined:""}},[n("v-row",[n("v-col",{staticStyle:{"max-width":"150px"}},[n("qrcode",{staticStyle:{"margin-to":"-5px"},attrs:{value:e.$store.state.name.label,tag:"img"}})],1),e._v(" "),n("v-col",[n("v-card",{attrs:{elevation:"0"}},[n("v-card-title",[e._v(" "+e._s(e.$store.state.name.label)+" ")]),e._v(" "),n("v-card-text",[e._v("Ask the customer to scan the QR Code to initiate a Payment\n            Request")])],1)],1)],1)],1),e._v(" "),n("PaymentIntents"),e._v(" "),n("PaymentRequestHistory")],1)}),[],!1,null,"78562945",null);t.default=T.exports;_()(T,{VBanner:V.a,VCard:F.a,VCardText:N.b,VCardTitle:N.c,VCol:E.a,VRow:B.a})}}]);